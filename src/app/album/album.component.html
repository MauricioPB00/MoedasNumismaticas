<div class="filters">
  <input type="text" placeholder="Buscar por nome" [(ngModel)]="searchName" (input)="applyFilters()">
  <input type="number" placeholder="Ano mínimo" [(ngModel)]="minYear" (input)="applyFilters()">
  <input type="number" placeholder="Ano máximo" [(ngModel)]="maxYear" (input)="applyFilters()">

  <select [(ngModel)]="selectedCondition" (change)="applyFilters()">
    <option *ngFor="let cond of uniqueConditions" [value]="cond">{{ cond }}</option>
  </select>

  <select [(ngModel)]="selectedIssuer" (change)="applyFilters()">
    <option value="">Todos os países</option>
    <option *ngFor="let country of uniqueIssuers" [value]="country">{{ country }}</option>
  </select>

  <button class="btn-ordenar" (click)="toggleSortOrder()">
    Ordenar {{ sortOrder === 'asc' ? '↑' : '↓' }}
  </button>

  <button class="btn-limpar" (click)="clearFilters()">Limpar filtros</button>
</div>

<div class="filters2">
  <div class="checkboxes-left">
    <label>
      <input type="checkbox" [(ngModel)]="groupByCoinId" (change)="toggleGroupByCoinId()" />
      Agrupar por moeda
    </label>

    <label>
      <input type="checkbox" [(ngModel)]="groupByYear" (change)="toggleGroupByYear()" />
      Agrupar por ano
    </label>

    <label>
      <input type="checkbox" [(ngModel)]="showCoins" (change)="applyFilters()" />
      Moedas
    </label>

    <label>
      <input type="checkbox" [(ngModel)]="showBanknotes" (change)="applyFilters()" />
      Cédulas
    </label>
  </div>

  <button class="btn-album-value" (click)="openModalPrice()">
    Valor do Álbum
  </button>
</div>


<div class="album-container" *ngIf="pagedCoins.length > 0; else emptyState">
  <div class="coin-card" *ngFor="let entry of pagedCoins" (click)="viewCoin(entry.id, entry.type)">
    <div class="coin-images">
      <img [src]="'/assets/img/imagens/' + (entry.obverse || 'placeholder.png')" (error)="onImgError($event)"
        alt="Obverse">
      <img [src]="'/assets/img/imagens/' + (entry.reverse || 'placeholder.png')" (error)="onImgError($event)"
        alt="Reverse">
    </div>
    <div class="coin-info">
      <h3>{{ entry.title }}</h3>
      <p>Ano: <span>{{ entry.yearsSummary || entry.year }}</span></p>
      <p>({{ entry.minYear }} - {{ entry.maxYear }})</p>
      <p>Quantidade: {{ entry.quantity || entry.quantityTotal }}</p>
      <p *ngIf="!groupByCoinId">Condição: {{ entry.condition || '—' }}</p>
      <p *ngIf="groupByCoinId">Condições: {{ entry.conditionsSummary || '—' }}</p>
    </div>
    <button class="icon-inline" (click)="abrirModal($event, entry.id, entry.type)">
      <i class="fas fa-edit"></i>
    </button>
  </div>
</div>

<ng-template #emptyState>
  <p class="empty">Nenhuma moeda encontrada.</p>
</ng-template>

<div class="pagination" *ngIf="totalPages > 1">
  <button (click)="prevPage()" [disabled]="currentPage === 1">Anterior</button>
  <span> Página {{ currentPage }} de {{ totalPages }} </span>
  <button (click)="nextPage()" [disabled]="currentPage === totalPages">Próxima</button>
</div>

<app-modal-coin *ngIf="showModal && coin" [show]="showModal" [coin]="coin" [coinEntries]="coinEntries"
  [albumCoins]="albumCoins" (closed)="showModal = false" (updated)="refreshAlbum()">
</app-modal-coin>

<app-modal-price *ngIf="showPriceModal" [show]="showPriceModal" (closed)="showPriceModal = false">
</app-modal-price>